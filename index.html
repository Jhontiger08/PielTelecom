<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Piel Telecom - A melhor e mais rápida internet fibra óptica de Mongaguá. Planos para gamers, home office e toda a família.">
    <title>Piel Telecom - A Melhor Internet Fibra Óptica</title>
    
    <!-- Favicon -->
    <link rel="icon" href="imgs/icone.png" type="image/png">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Flickity Carousel -->
    <link rel="stylesheet" href="https://unpkg.com/flickity@2/dist/flickity.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" xintegrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Estilos Internos Otimizados -->
    <style>
        :root {
            --brand-gold: #e5a10d;
            --brand-gold-dark: #d4910c;
            --text-primary: #111827; /* gray-900 */
            --text-secondary: #4b5563; /* gray-600 */
            --border-color: #d1d5db; /* gray-300 */
            --background-light: #f9fafb; /* gray-50 */
            --success-green: #16a34a; /* green-600 */
        }

        body {
            font-family: 'Inter', sans-serif;
            color: var(--text-secondary);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .hero-bg {
            background: linear-gradient(rgba(30, 20, 20, 0.85), rgba(15, 10, 10, 0.95)), url('imgs/fotofundo.jpg') no-repeat center center;
            background-size: cover;
        }

        .gold-accent { color: var(--brand-gold); }

        .cta-button {
            display: inline-flex;
            width: auto;
            align-items: center;
            justify-content: center;
            text-align: center;
            background-color: var(--brand-gold);
            color: white;
            font-weight: 700;
            padding: 0.9rem 2rem;
            border-radius: 0.5rem;
            font-size: 1.125rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease-out, background-color 0.2s ease-out;
            transform-origin: center;
        }
        .cta-button:hover {
            background-color: var(--brand-gold-dark);
            transform: scale(1.03);
        }
        .cta-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: scale(1);
        }
        @media (max-width: 640px) { .cta-button { width: 100%; } }

        .plan-card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.07), 0 4px 6px -2px rgba(0,0,0,0.05);
            padding: 1.5rem;
            border: 2px solid transparent;
            transition: transform 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .plan-card:hover { transform: translateY(-6px); }
        .plan-card.recommended-plan {
            border-color: var(--brand-gold);
            box-shadow: 0 10px 30px rgba(229, 161, 13, 0.3);
        }

        .contratar-btn .arrow-icon {
            opacity: 0;
            transform: translateX(-10px);
            transition: all 0.3s ease;
        }
        .contratar-btn:hover .arrow-icon {
            opacity: 1;
            transform: translateX(0);
        }

        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            background-color: var(--background-light);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            box-shadow: inset 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            transition: border-color 0.2s, box-shadow 0.2s, background-color 0.2s;
        }
        .form-input:focus {
            outline: none;
            background-color: white;
            border-color: var(--brand-gold);
            box-shadow: 0 0 0 3px rgba(229, 161, 13, 0.3);
        }
        .form-input.is-invalid {
            border-color: #ef4444; /* red-500 */
        }
        .form-input.is-invalid:focus {
             box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.4);
        }
        .error-message {
            color: #ef4444;
            font-size: 0.875rem;
            margin-top: 0.25rem;
            min-height: 1.25rem;
        }


        .form-radio-label {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .form-radio-label:hover {
            background-color: var(--background-light);
            border-color: #9ca3af;
        }
        .form-radio-label.is-checked {
            background-color: #fefce8; /* yellow-50 */
            border-color: var(--brand-gold);
            box-shadow: 0 0 0 2px rgba(229, 161, 13, 0.4);
        }

        .promo-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background-color: #ef4444; /* red-500 */
            color: white;
            font-size: 0.75rem;
            font-weight: 700;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            transform: rotate(12deg);
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid var(--brand-gold);
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in-element { opacity: 0; }
        .fade-in-element.is-visible { animation: fadeIn 0.7s ease-out forwards; }

        .carousel-cell {
            width: 100%;
            padding: 0 10px;
            margin-bottom: 1.5rem;
            box-sizing: border-box;
        }
        @media screen and (min-width: 768px) { .carousel-cell { width: 50%; } }
        @media screen and (min-width: 1024px) { .carousel-cell { width: 33.33%; } }

        .flickity-prev-next-button { width: 44px; height: 44px; background: rgba(255, 255, 255, 0.9); color: #333; }
        .flickity-prev-next-button:hover { background: var(--brand-gold); color: white; }
        .flickity-page-dots .dot { background: #ccc; }
        .flickity-page-dots .dot.is-selected { background: var(--brand-gold); }
        
        .whatsapp-float {
            position: fixed;
            width: 60px;
            height: 60px;
            bottom: 40px;
            right: 40px;
            background-color: #25d366;
            color: #FFF;
            border-radius: 50px;
            text-align: center;
            font-size: 30px;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease;
        }
        .whatsapp-float:hover {
            transform: scale(1.1);
        }

        /* Estilo customizado para o scroll da lista de cidades */
        #city-list-container::-webkit-scrollbar {
          width: 8px;
        }
        #city-list-container::-webkit-scrollbar-track {
          background: #f1f1f1;
          border-radius: 10px;
        }
        #city-list-container::-webkit-scrollbar-thumb {
          background: #d1d5db; /* gray-300 */
          border-radius: 10px;
        }
        #city-list-container::-webkit-scrollbar-thumb:hover {
          background: #9ca3af; /* gray-400 */
        }

        /* --- INÍCIO: ESTILOS DO CHAT DO JARVIS --- */
        #jarvis-chat-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        #jarvis-chat-button {
            width: 60px;
            height: 60px;
            background-color: var(--brand-gold);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: transform 0.3s ease, background-color 0.3s ease;
        }
        #jarvis-chat-button:hover {
            transform: scale(1.1);
            background-color: var(--brand-gold-dark);
        }
        #jarvis-chat-container {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 90vw;
            max-width: 400px;
            height: 70vh;
            max-height: 600px;
            background-color: #f3f4f6;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            transform: translateY(20px) scale(0.95);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            transform-origin: bottom right;
            pointer-events: none;
        }
        #jarvis-chat-container.is-open {
            transform: translateY(0) scale(1);
            opacity: 1;
            pointer-events: auto;
        }
        #jarvis-chat-log {
            flex-grow: 1;
            padding: 1rem;
            overflow-y: auto;
        }
        #jarvis-chat-log::-webkit-scrollbar {
            width: 6px;
        }
        #jarvis-chat-log::-webkit-scrollbar-track {
            background: #e5e7eb;
        }
        #jarvis-chat-log::-webkit-scrollbar-thumb {
            background: #9ca3af;
            border-radius: 6px;
        }
        .jarvis-message, .user-message {
            display: flex;
            margin-bottom: 1rem;
            max-width: 85%;
        }
        .user-message {
            margin-left: auto;
            flex-direction: row-reverse;
        }
        .message-bubble {
            padding: 0.75rem 1rem;
            border-radius: 1.25rem;
            line-height: 1.5;
        }
        .jarvis-message .message-bubble {
            background-color: white;
            color: var(--text-primary);
            border-bottom-left-radius: 0.25rem;
        }
        .user-message .message-bubble {
            background-color: var(--brand-gold);
            color: white;
            border-bottom-right-radius: 0.25rem;
        }
        .typing-indicator {
            display: flex;
            align-items: center;
        }
        .typing-indicator span {
            height: 8px;
            width: 8px;
            margin: 0 2px;
            background-color: #9E9E9E;
            border-radius: 50%;
            display: inline-block;
            animation: jarvis-blinker 1.4s infinite both;
        }
        .typing-indicator span:nth-child(2) { animation-delay: .2s; }
        .typing-indicator span:nth-child(3) { animation-delay: .4s; }
        @keyframes jarvis-blinker {
            0% { opacity: .2; }
            20% { opacity: 1; }
            100% { opacity: .2; }
        }
        /* --- FIM: ESTILOS DO CHAT DO JARVIS --- */
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- CABEÇALHO E NAVEGAÇÃO -->
    <header class="bg-white/90 backdrop-blur-lg shadow-sm sticky top-0 z-40">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
            <a href="index.html" class="flex items-center" aria-label="Página Inicial da Piel Telecom">
                <!-- LOGO: Caminho corrigido -->
                <img src="imgs/logo.png" alt="Logo Piel Telecom" class="h-10 w-auto" onerror="this.onerror=null;this.src='https://placehold.co/150x40/111827/e5a10d?text=Piel+Telecom';">
            </a>

            <div class="hidden md:flex items-center space-x-6">
                <a href="planos.html" class="text-gray-600 hover:text-brand-gold font-medium transition-colors">Planos</a>
                <a href="#diferenciais" class="text-gray-600 hover:text-brand-gold font-medium transition-colors">Diferenciais</a>
                <a href="#depoimentos" class="text-gray-600 hover:text-brand-gold font-medium transition-colors">Depoimentos</a>
                <a href="#" class="bg-yellow-100 text-brand-gold font-semibold px-4 py-2 rounded-lg hover:bg-yellow-200 transition-colors">Área do Cliente</a>
            </div>

            <div class="md:hidden">
                <button id="menu-btn" aria-label="Abrir menu" aria-expanded="false" aria-controls="mobile-menu" class="p-2">
                    <svg id="menu-icon-open" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                    <svg id="menu-icon-close" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
        </nav>
        <div id="mobile-menu" class="hidden md:hidden" role="navigation">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3 border-t border-gray-200">
                <a href="planos.html" class="mobile-menu-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-white hover:bg-brand-gold">Planos</a>
                <a href="#diferenciais" class="mobile-menu-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-white hover:bg-brand-gold">Diferenciais</a>
                <a href="#depoimentos" class="mobile-menu-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-white hover:bg-brand-gold">Depoimentos</a>
                <a href="#" class="mobile-menu-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-white hover:bg-brand-gold">Área do Cliente</a>
            </div>
        </div>
    </header>

    <main>
        <!-- SEÇÃO HERO -->
        <section id="hero-section" class="hero-bg text-white py-20 md:py-32">
            <div class="container mx-auto px-6 text-center fade-in-element is-visible">
                <span class="inline-block bg-white/10 border border-white/20 rounded-full px-4 py-2 text-sm font-semibold mb-6">🏆 A Melhor Internet de Mongaguá</span>
                <h1 class="text-4xl md:text-6xl font-extrabold leading-tight mb-4">Conexão de verdade, <br class="hidden sm:block">sempre ao seu lado.</h1>
                <p class="text-lg md:text-xl text-yellow-100/90 mb-10 max-w-3xl mx-auto">Navegue, trabalhe, jogue e assista com a estabilidade e a velocidade que só a Piel Telecom oferece.</p>
                <a href="planos.html" class="cta-button">Conheça Nossos Planos</a>
            </div>
        </section>

        <!-- SEÇÃO RECOMENDADOR IA -->
        <section id="recomendador" class="py-20 bg-white">
            <div class="container mx-auto px-6 text-center fade-in-element">
                <h2 class="text-3xl font-bold text-gray-900">Não sabe qual plano escolher?</h2>
                <p class="text-lg text-gray-600 mt-2 mb-8">Descreva sua necessidade e deixe nossa IA encontrar o plano perfeito para você!</p>
                <div class="max-w-3xl mx-auto bg-gray-50 p-6 md:p-8 rounded-xl shadow-lg">
                    <div class="space-y-4">
                        <div class="text-left">
                            <label for="needs-input" class="font-semibold text-gray-700">Como você e sua família usam a internet?</label>
                            <textarea id="needs-input" class="form-input mt-2" rows="3" placeholder="Ex: Somos 4 pessoas, usamos para filmes em 4K, jogos online e trabalho de casa."></textarea>
                        </div>
                        <button id="recommend-btn" class="cta-button">
                            <span class="gemini-icon mr-2">✨</span> Encontrar meu plano ideal
                        </button>
                        <div id="recommend-loader" class="hidden mx-auto loader"></div>
                        <p id="recommender-error" class="text-red-600 mt-2 hidden"></p>
                    </div>
                </div>
            </div>
        </section>

        <!-- SEÇÃO PLANOS -->
        <section id="planos" class="py-12 md:py-20 bg-gray-100">
            <div class="container mx-auto px-4 sm:px-6">

                <!-- Container para Planos Recomendados (gerado via JS) -->
                <div id="recommended-plans-container" class="hidden">
                    <div class="text-center mb-12">
                        <h2 class="text-3xl md:text-4xl font-bold text-gray-900">Aqui estão os 3 melhores planos para o seu perfil!</h2>
                        <p class="text-md md:text-lg text-gray-600 mt-2">Analisamos suas respostas e separamos as opções com o melhor custo-benefício.</p>
                    </div>
                    <!-- Carrossel sem inicialização via data-attribute para controle total do JS -->
                    <div id="recommended-plans-grid" class="main-carousel -mx-3">
                    </div>
                    <div class="text-center mt-12">
                        <a href="planos.html" class="bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded-lg hover:bg-gray-300 transition-colors">Ver todos os planos</a>
                    </div>
                </div>

                <!-- Container para Planos em Destaque (visível por padrão) -->
                <div id="all-plans-container">
                    <div class="mb-16">
                        <div class="text-center mb-12 fade-in-element">
                            <h2 class="text-3xl md:text-4xl font-bold text-gray-900">Planos em <span class="gold-accent">Promoção</span></h2>
                            <p class="text-md md:text-lg text-gray-600 mt-2">As melhores ofertas para você aproveitar a ultravelocidade pagando menos.</p>
                        </div>

                        <!-- Carrossel sem inicialização via data-attribute para controle total do JS -->
                        <div id="promo-carousel" class="main-carousel -mx-3">

                            <!-- Plano 200M -->
                            <div class="carousel-cell">
                                <div id="plan-promo-200" class="plan-card fade-in-element relative bg-white p-6 rounded-xl shadow-lg flex flex-col h-full" data-price="R$ 79,99/mês" data-plan="Piel Telecom Fibra 200M+">
                                    <div class="promo-badge">OFERTA</div>
                                    <h3 class="text-2xl font-bold text-gray-900">Fibra 200M+</h3>
                                    <p class="text-gray-500 mb-4">Para uso básico e redes sociais</p>
                                    <div class="my-4 text-gray-800"><span class="text-sm">Por apenas</span><p class="flex items-baseline"><span class="text-5xl font-extrabold">R$79</span><span class="text-2xl font-bold">,99</span><span class="font-medium ml-1">/mês</span></p></div>
                                    <div class="flex-grow"><ul class="space-y-3 mb-8 text-left"><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Download: 200 Mbps</li><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Upload: 100 Mbps</li></ul></div>
                                    <div class="gemini-reason-container"></div>
                                    <button class="contratar-btn w-full bg-gray-800 hover:bg-black text-white font-bold py-3 px-6 rounded-lg text-lg transition-colors duration-300 flex items-center justify-center gap-2 mt-auto">Contratar Agora <span class="arrow-icon">&rarr;</span></button>
                                </div>
                            </div>

                            <!-- Plano 600M -->
                            <div class="carousel-cell">
                                <div id="plan-promo-600" class="plan-card fade-in-element relative bg-white p-6 rounded-xl shadow-lg flex flex-col h-full border-2 border-[#e5a10d]" data-price="R$ 99,99/mês" data-plan="Piel Telecom Fibra 600M+">
                                    <span class="absolute top-0 -translate-y-1/2 left-1/2 -translate-x-1/2 bg-[#e5a10d] text-white text-sm font-bold px-4 py-1 rounded-full z-10">MELHOR CUSTO-BENEFÍCIO</span>
                                    <div class="promo-badge">OFERTA</div>
                                    <h3 class="text-2xl font-bold text-gray-900 mt-2">Fibra 600M+</h3>
                                    <p class="text-gray-500 mb-4">Perfeito para Família e Streaming 4K</p>
                                    <div class="my-4 text-gray-800"><span class="text-sm">Por apenas</span><p class="flex items-baseline"><span class="text-5xl font-extrabold">R$99</span><span class="text-2xl font-bold">,99</span><span class="font-medium ml-1">/mês</span></p></div>
                                    <div class="flex-grow"><ul class="space-y-3 mb-8 text-left"><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Download: 600 Mbps</li><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Upload: 300 Mbps</li></ul></div>
                                    <div class="gemini-reason-container"></div>
                                    <button class="contratar-btn w-full bg-[#e5a10d] hover:bg-[#d4910c] text-white font-bold py-3 px-6 rounded-lg text-lg transition-colors duration-300 flex items-center justify-center gap-2 mt-auto">Quero este! <span class="arrow-icon">&rarr;</span></button>
                                </div>
                            </div>

                            <!-- Plano 1 Giga -->
                            <div class="carousel-cell">
                                <div id="plan-promo-1000" class="plan-card fade-in-element relative bg-white p-6 rounded-xl shadow-lg flex flex-col h-full" data-price="R$ 119,99/mês" data-plan="Piel Telecom Fibra 1 Giga+">
                                    <div class="promo-badge">OFERTA</div>
                                    <h3 class="text-2xl font-bold text-gray-900">Fibra 1 Giga+</h3>
                                    <p class="text-gray-500 mb-4">Velocidade máxima com preço de oferta</p>
                                    <div class="my-4 text-gray-800"><span class="text-sm">Por apenas</span><p class="flex items-baseline"><span class="text-5xl font-extrabold">R$119</span><span class="text-2xl font-bold">,99</span><span class="font-medium ml-1">/mês</span></p></div>
                                    <div class="flex-grow"><ul class="space-y-3 mb-8 text-left"><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Download: 1 Gbps</li><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Upload: 500 Mbps</li></ul></div>
                                    <div class="gemini-reason-container"></div>
                                    <button class="contratar-btn w-full bg-gray-800 hover:bg-black text-white font-bold py-3 px-6 rounded-lg text-lg transition-colors duration-300 flex items-center justify-center gap-2 mt-auto">Contratar Agora <span class="arrow-icon">&rarr;</span></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Template para clonar os planos no recomendador -->
        <template id="all-plans-storage">
            <div id="plan-200" class="plan-card" data-price="R$ 79,99/mês" data-plan="Fibra Home 200M+"><h3 class="text-2xl font-bold text-gray-900">Fibra 200M+</h3><p class="text-gray-500 mb-4">Uso básico, redes sociais, vídeos HD</p><div class="my-4 text-gray-800"><span class="text-sm">Por apenas</span><p class="flex items-baseline"><span class="text-5xl font-extrabold">R$79</span><span class="text-2xl font-bold">,99</span><span class="font-medium ml-1">/mês</span></p></div><div class="flex-grow"><ul class="space-y-3 mb-8 text-left"><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Download: 200 Mbps</li><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Upload: 100 Mbps</li></ul></div><div class="gemini-reason-container mt-auto"></div><button class="contratar-btn w-full bg-gray-800 hover:bg-black text-white font-bold py-3 px-6 rounded-lg text-lg transition-colors duration-300 flex items-center justify-center gap-2 mt-4">Contratar Agora <span class="arrow-icon">&rarr;</span></button></div>
            <div id="plan-400" class="plan-card" data-price="R$ 94,99/mês" data-plan="Fibra Home 400M+"><h3 class="text-2xl font-bold text-gray-900">Fibra 400M+</h3><p class="text-gray-500 mb-4">Família pequena e home office</p><div class="my-4"><span class="text-5xl font-extrabold">R$94</span><span class="text-2xl font-bold">,99</span><span class="font-medium">/mês</span></div><div class="flex-grow"><ul class="space-y-3 mb-8 text-left"><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Download: 400 Mbps</li><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Upload: 200 Mbps</li></ul></div><div class="gemini-reason-container mt-auto"></div><button class="contratar-btn w-full bg-gray-800 hover:bg-black text-white font-bold py-3 px-6 rounded-lg text-lg transition-colors duration-300 flex items-center justify-center gap-2 mt-4">Contratar Agora <span class="arrow-icon">&rarr;</span></button></div>
            <div id="plan-600" class="plan-card" data-price="R$ 99,99/mês" data-plan="Fibra Home 600M+"><h3 class="text-2xl font-bold text-gray-900">Fibra 600M+</h3><p class="text-gray-500 mb-4">Família, streaming 4K, ótimo custo-benefício</p><div class="my-4 text-gray-800"><span class="text-sm">Por apenas</span><p class="flex items-baseline"><span class="text-5xl font-extrabold">R$99</span><span class="text-2xl font-bold">,99</span><span class="font-medium ml-1">/mês</span></p></div><div class="flex-grow"><ul class="space-y-3 mb-8 text-left"><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Download: 600 Mbps</li><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Upload: 300 Mbps</li></ul></div><div class="gemini-reason-container mt-auto"></div><button class="contratar-btn w-full bg-brand-gold hover:bg-brand-gold-dark text-white font-bold py-3 px-6 rounded-lg text-lg transition-colors duration-300 flex items-center justify-center gap-2 mt-4">Quero este! <span class="arrow-icon">&rarr;</span></button></div>
            <div id="plan-1000" class="plan-card" data-price="R$ 119,99/mês" data-plan="Fibra Home 1G+"><h3 class="text-2xl font-bold text-gray-900">Fibra 1 Giga+</h3><p class="text-gray-500 mb-4">Velocidade máxima com preço de oferta</p><div class="my-4 text-gray-800"><span class="text-sm">Por apenas</span><p class="flex items-baseline"><span class="text-5xl font-extrabold">R$119</span><span class="text-2xl font-bold">,99</span><span class="font-medium ml-1">/mês</span></p></div><div class="flex-grow"><ul class="space-y-3 mb-8 text-left"><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Download: 1 Gbps</li><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Upload: 500 Mbps</li></ul></div><div class="gemini-reason-container mt-auto"></div><button class="contratar-btn w-full bg-gray-800 hover:bg-black text-white font-bold py-3 px-6 rounded-lg text-lg transition-colors duration-300 flex items-center justify-center gap-2 mt-4">Contratar Agora <span class="arrow-icon">&rarr;</span></button></div>
            
            <!-- Novos planos adicionados -->
            <div id="plan-1000-homeoffice" class="plan-card" data-price="R$ 169,99/mês" data-plan="Fibra 1G+ Home Office"><h3 class="text-2xl font-bold text-gray-900">1 Giga+ Home Office</h3><p class="text-gray-500 mb-4">Otimizado para trabalho remoto</p><div class="my-4 text-gray-800"><p class="flex items-baseline"><span class="text-5xl font-extrabold">R$169</span><span class="text-2xl font-bold">,99</span><span class="font-medium ml-1">/mês</span></p></div><div class="flex-grow"><ul class="space-y-3 mb-8 text-left"><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Download: 1 Gbps</li><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Upload: 500 Mbps</li><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Otimização para videochamadas</li></ul></div><div class="gemini-reason-container mt-auto"></div><button class="contratar-btn w-full bg-gray-800 hover:bg-black text-white font-bold py-3 px-6 rounded-lg text-lg transition-colors duration-300 flex items-center justify-center gap-2 mt-4">Contratar Agora <span class="arrow-icon">&rarr;</span></button></div>
            <div id="plan-1000-gamer" class="plan-card" data-price="R$ 169,99/mês" data-plan="Fibra 1G+ Gamer"><h3 class="text-2xl font-bold text-gray-900">1 Giga+ Gamer</h3><p class="text-gray-500 mb-4">Ping baixo e rotas otimizadas</p><div class="my-4 text-gray-800"><p class="flex items-baseline"><span class="text-5xl font-extrabold">R$169</span><span class="text-2xl font-bold">,99</span><span class="font-medium ml-1">/mês</span></p></div><div class="flex-grow"><ul class="space-y-3 mb-8 text-left"><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Download: 1 Gbps</li><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Upload: 500 Mbps</li><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Wi-Fi 6 Gamer</li></ul></div><div class="gemini-reason-container mt-auto"></div><button class="contratar-btn w-full bg-gray-800 hover:bg-black text-white font-bold py-3 px-6 rounded-lg text-lg transition-colors duration-300 flex items-center justify-center gap-2 mt-4">Contratar Agora <span class="arrow-icon">&rarr;</span></button></div>
            <div id="plan-1000-black" class="plan-card" data-price="R$ 199,99/mês" data-plan="Fibra 1G+ Black"><h3 class="text-2xl font-bold text-gray-900">1 Giga+ Black</h3><p class="text-gray-500 mb-4">Para heavy users e casa conectada</p><div class="my-4 text-gray-800"><p class="flex items-baseline"><span class="text-5xl font-extrabold">R$199</span><span class="text-2xl font-bold">,99</span><span class="font-medium ml-1">/mês</span></p></div><div class="flex-grow"><ul class="space-y-3 mb-8 text-left"><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Download: 1 Gbps</li><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Upload: 500 Mbps</li><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Equipamentos Premium (Wi-Fi 6/6E)</li></ul></div><div class="gemini-reason-container mt-auto"></div><button class="contratar-btn w-full bg-gray-800 hover:bg-black text-white font-bold py-3 px-6 rounded-lg text-lg transition-colors duration-300 flex items-center justify-center gap-2 mt-4">Contratar Agora <span class="arrow-icon">&rarr;</span></button></div>
            <div id="plan-1000-black-disney" class="plan-card" data-price="R$ 239,99/mês" data-plan="Fibra 1G+ Black c/ Disney+"><h3 class="text-2xl font-bold text-gray-900">1 Giga+ Black c/ Disney+</h3><p class="text-gray-500 mb-4">Pacote completo com streaming</p><div class="my-4 text-gray-800"><p class="flex items-baseline"><span class="text-5xl font-extrabold">R$239</span><span class="text-2xl font-bold">,99</span><span class="font-medium ml-1">/mês</span></p></div><div class="flex-grow"><ul class="space-y-3 mb-8 text-left"><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Download: 1 Gbps</li><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Upload: 500 Mbps</li><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Disney+ incluso</li></ul></div><div class="gemini-reason-container mt-auto"></div><button class="contratar-btn w-full bg-gray-800 hover:bg-black text-white font-bold py-3 px-6 rounded-lg text-lg transition-colors duration-300 flex items-center justify-center gap-2 mt-4">Contratar Agora <span class="arrow-icon">&rarr;</span></button></div>
            <div id="plan-socio-torcedor" class="plan-card" data-price="Preço Especial" data-plan="Sócio Torcedor 800M"><h3 class="text-2xl font-bold text-gray-900">Sócio Torcedor 800M</h3><p class="text-gray-500 mb-4">Exclusivo para torcedores</p><div class="my-4 text-gray-800"><p class="text-3xl font-bold">Preço Especial</p></div><div class="flex-grow"><ul class="space-y-3 mb-8 text-left"><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Download: 800 Mbps</li><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Upload: 400 Mbps</li><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Ajude seu time do coração</li></ul></div><div class="gemini-reason-container mt-auto"></div><button class="contratar-btn w-full bg-gray-800 hover:bg-black text-white font-bold py-3 px-6 rounded-lg text-lg transition-colors duration-300 flex items-center justify-center gap-2 mt-4">Consultar <span class="arrow-icon">&rarr;</span></button></div>
            <div id="plan-combo-movel" class="plan-card" data-price="Consultar" data-plan="Fibra 600M+ Combo Móvel"><h3 class="text-2xl font-bold text-gray-900">Fibra 600M+ Combo Móvel</h3><p class="text-gray-500 mb-4">Conveniência e economia</p><div class="my-4 text-gray-800"><p class="text-3xl font-bold">Consultar Preço</p></div><div class="flex-grow"><ul class="space-y-3 mb-8 text-left"><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Download: 600 Mbps</li><li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Plano de celular com 10GB ou 15GB</li></ul></div><div class="gemini-reason-container mt-auto"></div><button class="contratar-btn w-full bg-gray-800 hover:bg-black text-white font-bold py-3 px-6 rounded-lg text-lg transition-colors duration-300 flex items-center justify-center gap-2 mt-4">Consultar <span class="arrow-icon">&rarr;</span></button></div>

        </template>
        
        <!-- SEÇÃO DIFERENCIAIS -->
        <section id="diferenciais" class="py-20 bg-white">
            <div class="container mx-auto px-6">
                <div class="text-center mb-16 fade-in-element">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-900">Não é só internet, é uma experiência <span class="gold-accent">Piel Telecom</span></h2>
                    <p class="text-lg text-gray-600 mt-2 max-w-3xl mx-auto">Entenda por que somos a escolha de quem busca mais do que uma simples conexão.</p>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-10">
                    <div class="text-center fade-in-element"><div class="bg-yellow-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4"><i class="fas fa-wave-square fa-2x text-brand-gold-dark"></i></div><h3 class="text-xl font-bold mb-2">Rede 100% Fibra</h3><p class="text-gray-600">Levamos a fibra óptica até dentro da sua casa (FTTH), garantindo máxima velocidade e uma conexão à prova de interferências.</p></div>
                    <div class="text-center fade-in-element" style="animation-delay: 0.1s;"><div class="bg-yellow-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4"><i class="fas fa-headset fa-2x text-brand-gold-dark"></i></div><h3 class="text-xl font-bold mb-2">Suporte que Resolve</h3><p class="text-gray-600">Nosso atendimento é local, humanizado e focado em resolver seu problema na primeira chamada.</p></div>
                    <div class="text-center fade-in-element" style="animation-delay: 0.2s;"><div class="bg-yellow-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4"><i class="fas fa-wifi fa-2x text-brand-gold-dark"></i></div><h3 class="text-xl font-bold mb-2">Wi-Fi de Verdade</h3><p class="text-gray-600">Oferecemos os melhores equipamentos, incluindo a tecnologia Wi-Fi 6, para que a ultravelocidade chegue em todos os cantos.</p></div>
                    <div class="text-center fade-in-element" style="animation-delay: 0.3s;"><div class="bg-yellow-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4"><i class="fas fa-medal fa-2x text-brand-gold-dark"></i></div><h3 class="text-xl font-bold mb-2">A Melhor da Região</h3><p class="text-gray-600">Somos reconhecidos pela velocidade e estabilidade, um reflexo da nossa dedicação à qualidade superior.</p></div>
                </div>
            </div>
        </section>

        <!-- SEÇÃO DEPOIMENTOS -->
        <section id="depoimentos" class="py-20 bg-gray-100">
            <div class="container mx-auto px-6">
                <div class="text-center mb-16 fade-in-element">
                    <h2 class="text-4xl font-bold text-gray-900">O que nossos <span class="gold-accent">clientes</span> dizem</h2>
                    <p class="text-lg text-gray-600 mt-2 max-w-3xl mx-auto">A confiança de quem usa e aprova a nossa conexão todos os dias.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <figure class="bg-white p-8 rounded-xl shadow-lg fade-in-element flex flex-col"><img loading="lazy" src="https://placehold.co/80x80/E2E8F0/4A5568?text=MS" alt="Foto da cliente Maria S." class="w-20 h-20 rounded-full mx-auto -mt-16 border-4 border-white"><blockquote class="text-gray-600 italic mt-4 flex-grow"><p>"Finalmente uma internet que não cai no meio da minha reunião! O suporte da Piel Telecom é rápido e resolve de verdade. Recomendo de olhos fechados."</p></blockquote><figcaption class="text-right font-bold text-gray-800 mt-4">- Maria S., Santos</figcaption></figure>
                    <figure class="bg-white p-8 rounded-xl shadow-lg fade-in-element flex flex-col" style="animation-delay: 0.1s;"><img loading="lazy" src="https://placehold.co/80x80/E2E8F0/4A5568?text=JP" alt="Foto do cliente João P." class="w-20 h-20 rounded-full mx-auto -mt-16 border-4 border-white"><blockquote class="text-gray-600 italic mt-4 flex-grow"><p>"Sou gamer e o ping baixo faz toda a diferença. Com a Piel Telecom, consigo jogar online sem lag nenhum. A estabilidade é incrível, valeu cada centavo."</p></blockquote><figcaption class="text-right font-bold text-gray-800 mt-4">- João P., Campinas</figcaption></figure>
                    <figure class="bg-white p-8 rounded-xl shadow-lg fade-in-element flex flex-col" style="animation-delay: 0.2s;"><img loading="lazy" src="https://placehold.co/80x80/E2E8F0/4A5568?text=AC" alt="Foto da cliente Ana C." class="w-20 h-20 rounded-full mx-auto -mt-16 border-4 border-white"><blockquote class="text-gray-600 italic mt-4 flex-grow"><p>"Trabalho em home office e preciso enviar arquivos pesados o tempo todo. A velocidade de upload da Piel Telecom é fantástica, agilizou muito a minha rotina."</p></blockquote><figcaption class="text-right font-bold text-gray-800 mt-4">- Ana C., Jundiaí</figcaption></figure>
                </div>
            </div>
        </section>
    </main>

    <!-- RODAPÉ MELHORADO -->
    <footer class="bg-gray-800 text-white">
        <div class="container mx-auto px-6 py-12">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div class="col-span-1 md:col-span-2">
                    <a href="/" class="flex items-center mb-4">
                        <img src="imgs/logo.png" alt="Logo Piel Telecom" class="h-10 w-auto" onerror="this.onerror=null;this.src='https://placehold.co/150x40/111827/e5a10d?text=Piel+Telecom';">
                    </a>
                    <p class="text-gray-400">Construindo conexões de verdade em Mongaguá. Internet 100% fibra óptica com a velocidade e estabilidade que você merece.</p>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-white mb-4">Links Rápidos</h3>
                    <ul class="space-y-2">
                        <li><a href="planos.html" class="text-gray-400 hover:text-brand-gold transition-colors">Nossos Planos</a></li>
                        <li><a href="/#diferenciais" class="text-gray-400 hover:text-brand-gold transition-colors">Diferenciais</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-brand-gold transition-colors">Área do Cliente</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-brand-gold transition-colors">Suporte</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-white mb-4">Siga-nos</h3>
                    <div class="flex space-x-4">
                        <a href="#" aria-label="Facebook" class="text-gray-400 hover:text-brand-gold transition-colors"><i class="fab fa-facebook-f fa-lg"></i></a>
                        <a href="#" aria-label="Instagram" class="text-gray-400 hover:text-brand-gold transition-colors"><i class="fab fa-instagram fa-lg"></i></a>
                        <a href="https://wa.me/5513991830277" aria-label="WhatsApp" class="text-gray-400 hover:text-brand-gold transition-colors"><i class="fab fa-whatsapp fa-lg"></i></a>
                    </div>
                </div>
            </div>
            <div class="mt-10 border-t border-gray-700 pt-6 text-center text-gray-500 text-sm">
                <p>&copy; 2024 Piel Telecom. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- ======================================================= -->
    <!-- INÍCIO: MODAL DE FILTRAGEM DE CIDADE                    -->
    <!-- ======================================================= -->
    <div id="city-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-[60] hidden" role="dialog" aria-modal="true" aria-labelledby="city-modal-title">
        <div id="city-modal-panel" class="bg-white rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] flex flex-col transform transition-all opacity-0 -translate-y-4">
            <!-- Cabeçalho do Modal -->
            <div class="p-5 border-b border-gray-200 flex justify-between items-center">
                <h2 id="city-modal-title" class="text-xl font-bold text-gray-900">Consulte a disponibilidade</h2>
                <button id="close-city-modal-btn" aria-label="Fechar modal" class="text-gray-400 hover:text-red-600 transition-colors p-1">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>

            <!-- Conteúdo do Modal -->
            <div class="p-6 overflow-y-auto">
                <p class="text-gray-600 mb-4">Primeiro, digite o nome da sua cidade para verificar se nossos serviços estão disponíveis na sua região.</p>
                
                <div class="relative">
                    <input type="text" id="city-search-input" placeholder="Digite sua cidade..." class="form-input !pl-10 peer">
                    <svg class="w-5 h-5 text-gray-400 absolute top-1/2 left-3 -translate-y-1/2 peer-focus:text-brand-gold" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                    </svg>
                </div>

                <p id="city-list-error" class="text-center text-red-500 my-4 hidden">Nenhuma cidade encontrada.</p>
                
                <!-- Lista de Cidades (será preenchida via JS) -->
                <div id="city-list-container" class="mt-4 border border-gray-200 rounded-lg max-h-64 overflow-y-auto">
                    <!-- Cidades filtradas aparecerão aqui -->
                </div>
            </div>

            <!-- Rodapé do Modal -->
            <div class="p-5 bg-gray-50 border-t border-gray-200 text-right rounded-b-xl">
                <button id="confirm-city-btn" class="cta-button w-full sm:w-auto" disabled>
                    Confirmar Cidade
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL DE CHECKOUT -->
    <div id="checkout-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 hidden" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[95vh] flex flex-col">
            <div class="p-6 border-b border-gray-200 flex justify-between items-start">
                <div>
                    <h2 id="modal-title" class="text-2xl font-bold text-gray-900">Finalizar Contratação</h2>
                    <p class="text-gray-600 mt-1">Plano: <span id="selected-plan-name" class="font-bold text-brand-gold"></span></p>
                </div>
                <button id="close-modal-btn" aria-label="Fechar modal" class="text-gray-500 hover:text-red-600 transition-colors p-1">
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="p-6 md:p-8 overflow-y-auto">
                <div id="whatsapp-form-container">
                    <form id="whatsapp-form" class="space-y-8" novalidate>
                        <fieldset><legend class="font-semibold text-lg text-gray-800 border-b pb-2 mb-4 flex items-center gap-2"><svg class="w-5 h-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg>Dados Pessoais</legend><div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4"><div><label for="wa-nome" class="block font-medium text-gray-700 mb-1">Nome Completo</label><input type="text" id="wa-nome" name="wa-nome" class="form-input" required><div class="error-message"></div></div><div><label for="wa-mae" class="block font-medium text-gray-700 mb-1">Nome da Mãe</label><input type="text" id="wa-mae" name="wa-mae" class="form-input" required><div class="error-message"></div></div><div class="md:col-span-2"><label for="wa-nascimento" class="block font-medium text-gray-700 mb-1">Data de Nascimento</label><input type="date" id="wa-nascimento" name="wa-nascimento" class="form-input" required><div class="error-message"></div></div></div></fieldset>
                        <fieldset><legend class="font-semibold text-lg text-gray-800 border-b pb-2 mb-4 flex items-center gap-2"><svg class="w-5 h-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z" /><path fill-rule="evenodd" d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm3 0a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1z" clip-rule="evenodd" /></svg>Documentos & Contato</legend><div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4"><div><label for="wa-cpf" class="block font-medium text-gray-700 mb-1">CPF</label><input type="text" id="wa-cpf" name="wa-cpf" class="form-input" required placeholder="000.000.000-00"><div class="error-message"></div></div><div><label for="wa-rg" class="block font-medium text-gray-700 mb-1">RG</label><input type="text" id="wa-rg" name="wa-rg" class="form-input" required><div class="error-message"></div></div><div><label for="wa-email" class="block font-medium text-gray-700 mb-1">E-mail</label><input type="email" id="wa-email" name="wa-email" class="form-input" required><div class="error-message"></div></div><div><label for="wa-tel1" class="block font-medium text-gray-700 mb-1">Telefone Titular</label><input type="tel" id="wa-tel1" name="wa-tel1" class="form-input" required placeholder="(00) 90000-0000"><div class="error-message"></div></div></div></fieldset>
                        <fieldset><legend class="font-semibold text-lg text-gray-800 border-b pb-2 mb-4 flex items-center gap-2"><svg class="w-5 h-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" /></svg>Endereço de Instalação</legend><div class="grid grid-cols-1 md:grid-cols-3 gap-x-6 gap-y-4"><div><label for="wa-cep" class="block font-medium text-gray-700 mb-1">CEP</label><input type="text" id="wa-cep" name="wa-cep" class="form-input" required placeholder="00000-000"><div class="error-message"></div></div><div class="md:col-span-2"><label for="wa-rua" class="block font-medium text-gray-700 mb-1">Rua</label><input type="text" id="wa-rua" name="wa-rua" class="form-input" required><div class="error-message"></div></div><div><label for="wa-numero" class="block font-medium text-gray-700 mb-1">Número</label><input type="text" id="wa-numero" name="wa-numero" class="form-input" required><div class="error-message"></div></div><div><label for="wa-bairro" class="block font-medium text-gray-700 mb-1">Bairro</label><input type="text" id="wa-bairro" name="wa-bairro" class="form-input" required><div class="error-message"></div></div><div><label for="wa-cidade" class="block font-medium text-gray-700 mb-1">Cidade</label><input type="text" id="wa-cidade" name="wa-cidade" class="form-input" required><div class="error-message"></div></div></div></fieldset>
                        <fieldset><legend class="font-semibold text-lg text-gray-800 border-b pb-2 mb-4 flex items-center gap-2"><svg class="w-5 h-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" /></svg>Agendamento da Instalação</legend><div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-2"><label for="periodo-manha" class="form-radio-label"><input type="radio" id="periodo-manha" name="installation_period" value="MANHÃ - 8 as 12h" class="hidden" required>Manhã (8h às 12h)</label><label for="periodo-tarde" class="form-radio-label"><input type="radio" id="periodo-tarde" name="installation_period" value="TARDE - 14 as 18h" class="hidden">Tarde (14h às 18h)</label></div><div id="radio-error-message" class="error-message"></div></fieldset>
                        <div class="pt-6 text-right"><button type="submit" id="submit-whatsapp-btn" class="cta-button">Continuar Cadastro</button></div>
                    </form>
                </div>
                <div id="whatsapp-success" class="text-center hidden py-10">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto"><svg class="w-10 h-10 text-success-green" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg></div>
                    <h2 class="text-3xl font-bold text-gray-800 mt-6">Tudo pronto!</h2>
                    <p class="text-gray-600 mt-4 max-w-md mx-auto">Preparamos uma mensagem com seus dados. Para finalizar, clique no botão abaixo e envie a mensagem no WhatsApp.</p>
                    <a id="whatsapp-send-link" href="#" target="_blank" class="cta-button mt-8" style="background-color: var(--success-green);"><svg class="w-6 h-6 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16.6 14.21a1.2 1.2 0 00-1.69.19l-1.22 1.52a10.05 10.05 0 01-4.88-4.88l1.52-1.22a1.2 1.2 0 00.19-1.69l-1.6-3.83a1.2 1.2 0 00-1.58-.72L4.58 4.7a1.2 1.2 0 00-.86 1.15c-.01.07 0 .14.02.2 1.24 5.23 6.37 10.36 11.6 11.6.06.02.13.03.2.03a1.2 1.2 0 001.15-.86l1.2-2.73a1.2 1.2 0 00-.72-1.58l-3.83-1.6zM12 2.04a10 10 0 00-10 10c0 5.52 4.48 10 10 10s10-4.48 10-10c0-5.52-4.48-10-10-10z"></path></svg>Abrir WhatsApp e Enviar</a>
                </div>
            </div>
        </div>
    </div>
    <!-- ======================================================= -->
    <!-- INÍCIO: WIDGET DE CHAT DO JARVIS                        -->
    <!-- ======================================================= -->
    <div id="jarvis-chat-widget">
        <div id="jarvis-chat-container">
            <!-- Cabeçalho do Chat -->
            <div class="bg-gray-800 text-white p-4 flex items-center shadow-md rounded-t-lg flex-shrink-0">
                <div class="w-10 h-10 rounded-full bg-brand-gold flex items-center justify-center mr-3 border-2 border-yellow-200/50">
                    <i class="fas fa-robot text-white"></i>
                </div>
                <div>
                    <h2 class="text-lg font-bold">Jarvis</h2>
                    <p class="text-xs text-gray-300">Assistente Virtual Piel Telecom</p>
                </div>
            </div>
            <!-- Log de Mensagens -->
            <div id="jarvis-chat-log">
                <!-- Mensagens dinâmicas aqui -->
            </div>
            <!-- Input de Mensagem -->
            <div class="bg-white p-3 border-t border-gray-200 rounded-b-lg flex-shrink-0">
                <div class="flex items-center">
                    <input type="text" id="jarvis-user-input" class="flex-1 border border-gray-300 rounded-full py-2 px-4 focus:outline-none focus:ring-2 focus:ring-brand-gold" placeholder="Digite sua mensagem...">
                    <button id="jarvis-send-button" class="ml-3 bg-brand-gold text-white rounded-full p-2.5 hover:bg-brand-gold-dark focus:outline-none focus:ring-2 focus:ring-brand-gold focus:ring-offset-2 transition-transform transform hover:scale-110">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                    </button>
                </div>
            </div>
        </div>
        <button id="jarvis-chat-button" aria-label="Abrir chat com Jarvis">
            <i id="jarvis-open-icon" class="fas fa-comment-dots fa-lg"></i>
            <i id="jarvis-close-icon" class="fas fa-times fa-lg hidden"></i>
        </button>
    </div>

    <!-- SCRIPTS -->
    <script src="https://unpkg.com/flickity@2/dist/flickity.pkgd.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
    // =======================================================
    // CONFIGURAÇÕES GLOBAIS E MAPEAMENTO DO DOM
    // =======================================================
    const CONFIG = {
        whatsappNumber: '5513991830277'
    };

    // !!! IMPORTANTE !!!
    // Esta é a chave API que já estava no seu site.
    // Certifique-se de que ela esteja correta e ativa.
    const USER_API_KEY = "AIzaSyDlJWR9Kqlpdvyi1XM1yaKHaQxfDs7V_Y0";

    const NODES = {
        // Navegação e Menu
        menuBtn: document.getElementById('menu-btn'),
        mobileMenu: document.getElementById('mobile-menu'),
        menuIconOpen: document.getElementById('menu-icon-open'),
        menuIconClose: document.getElementById('menu-icon-close'),
        mobileMenuLinks: document.querySelectorAll('.mobile-menu-link'),
        
        // Elementos gerais e animações
        fadeInElements: document.querySelectorAll('.fade-in-element'),
        promoCarousel: document.getElementById('promo-carousel'),

        // Recomendador IA
        recommendBtn: document.getElementById('recommend-btn'),
        needsInput: document.getElementById('needs-input'),
        recommendLoader: document.getElementById('recommend-loader'),
        recommenderError: document.getElementById('recommender-error'),
        recommendedContainer: document.getElementById('recommended-plans-container'),
        recommendedGrid: document.getElementById('recommended-plans-grid'),
        allPlansContainer: document.getElementById('all-plans-container'),
        allPlansStorage: document.getElementById('all-plans-storage'),

        // Modal de Cidade
        cityModal: document.getElementById('city-modal'),
        cityModalPanel: document.getElementById('city-modal-panel'),
        closeCityModalBtn: document.getElementById('close-city-modal-btn'),
        citySearchInput: document.getElementById('city-search-input'),
        cityListContainer: document.getElementById('city-list-container'),
        cityListError: document.getElementById('city-list-error'),
        confirmCityBtn: document.getElementById('confirm-city-btn'),

        // Modal de Checkout
        checkoutModal: document.getElementById('checkout-modal'),
        closeModalBtn: document.getElementById('close-modal-btn'),
        selectedPlanNameSpan: document.getElementById('selected-plan-name'),
        
        // Formulário WhatsApp
        whatsappFormContainer: document.getElementById('whatsapp-form-container'),
        whatsappSuccessContainer: document.getElementById('whatsapp-success'),
        whatsappForm: document.getElementById('whatsapp-form'),
        whatsappSendLink: document.getElementById('whatsapp-send-link'),
        radioLabels: document.querySelectorAll('.form-radio-label'),
        cepInput: document.getElementById('wa-cep'),
        cpfInput: document.getElementById('wa-cpf'),
        telInput: document.getElementById('wa-tel1')
    };
    
    let selectedPlanInfo = {};

    // =======================================================
    // FUNÇÕES DE UTILIDADE GERAL E DO SITE ORIGINAL
    // =======================================================

    function toggleMobileMenu() {
        const isExpanded = NODES.menuBtn.getAttribute('aria-expanded') === 'true';
        NODES.menuBtn.setAttribute('aria-expanded', !isExpanded);
        NODES.mobileMenu.classList.toggle('hidden');
        NODES.menuIconOpen.classList.toggle('hidden');
        NODES.menuIconClose.classList.toggle('hidden');
    }

    function initScrollAnimation() {
        if (!('IntersectionObserver' in window)) return;
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1 });
        NODES.fadeInElements.forEach(el => observer.observe(el));
    }

    function displayUserError(message, errorElement) {
        if (errorElement) {
            errorElement.textContent = message;
            errorElement.classList.remove('hidden');
        }
    }
    
    function getAllPlansFromDOM() {
        const planNodes = NODES.allPlansStorage.content.querySelectorAll('.plan-card');
        const plans = [];
        planNodes.forEach(node => {
            const features = Array.from(node.querySelectorAll('ul li')).map(li => li.textContent.trim());
            plans.push({
                id: node.id,
                name: node.querySelector('h3').textContent.trim(),
                description: node.querySelector('p').textContent.trim(),
                price: node.dataset.price,
                features: features
            });
        });
        return plans;
    }

    async function handleRecommendation() {
        const userInput = NODES.needsInput.value.trim();
        if (!userInput) {
            displayUserError("Por favor, descreva sua necessidade para a IA.", NODES.recommenderError);
            return;
        }

        if (USER_API_KEY === "COLE_SUA_API_KEY_AQUI" || !USER_API_KEY) {
            displayUserError("API Key do Google não configurada. Por favor, adicione sua chave no código para a IA funcionar.", NODES.recommenderError);
            console.warn("Chave de API do Gemini não encontrada. Insira sua chave na variável USER_API_KEY.");
            return;
        }

        if (NODES.recommenderError) NODES.recommenderError.classList.add('hidden');
        NODES.recommendLoader.classList.remove('hidden');
        NODES.recommendBtn.disabled = true;

        const allPlans = getAllPlansFromDOM();
        const prompt = `Você é um assistente especialista em vendas de planos de internet da empresa Piel Telecom. Sua tarefa é analisar a necessidade de um cliente e recomendar os 3 melhores planos de internet para ele, com base na lista de planos disponíveis. **Necessidade do Cliente:** "${userInput}" **Lista de Planos Disponíveis (formato JSON):** ${JSON.stringify(allPlans, null, 2)} **Instruções:** 1. Analise a necessidade do cliente e compare com os detalhes de cada plano. 2. Selecione os 3 planos mais adequados. 3. Para cada plano recomendado, escreva uma justificativa curta e amigável (em português do Brasil). 4. Retorne sua resposta estritamente no formato JSON especificado no schema. Não inclua nenhuma outra informação ou texto fora do JSON. 5. IMPORTANTE: Assegure que o JSON de saída seja perfeitamente válido. O campo "reason" deve ser uma string única, sem quebras de linha literais e com aspas duplas devidamente escapadas (\\").`;

        const payload = {
            contents: [{ role: "user", parts: [{ text: prompt }] }],
            generationConfig: {
                responseMimeType: "application/json",
                responseSchema: { type: "OBJECT", properties: { "recommendations": { type: "ARRAY", items: { type: "OBJECT", properties: { "planId": { "type": "STRING" }, "reason": { "type": "STRING" } }, required: ["planId", "reason"] } } }, required: ["recommendations"] }
            }
        };
        
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${USER_API_KEY}`;

        try {
            const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) {
                const errorBody = await response.text();
                throw new Error(`API Error: ${response.status} ${response.statusText} - ${errorBody}`);
            }
            const result = await response.json();
            if (!result.candidates || result.candidates.length === 0) {
                throw new Error("A resposta da IA está vazia ou em formato inesperado.");
            }
            const jsonText = result.candidates[0].content.parts[0].text;
            try {
                const parsedResult = JSON.parse(jsonText);
                renderRecommendations(parsedResult);
            } catch (parseError) {
                console.error("Erro ao parsear JSON da IA:", parseError);
                throw new Error(`A IA retornou um JSON inválido: ${jsonText}`);
            }
        } catch (error) {
            console.error("Falha ao obter recomendação da API Gemini:", error);
            displayUserError("Desculpe, a IA não conseguiu gerar uma recomendação. Tente novamente mais tarde.", NODES.recommenderError);
        } finally {
            NODES.recommendLoader.classList.add('hidden');
            NODES.recommendBtn.disabled = false;
        }
    }

    function renderRecommendations(result) {
        const flkty = Flickity.data(NODES.recommendedGrid);
        if (flkty) flkty.destroy();
        
        NODES.recommendedGrid.innerHTML = ''; 

        if (!result.recommendations || result.recommendations.length === 0) {
             displayUserError("Não foram encontradas recomendações.", NODES.recommenderError);
             return;
        }

        result.recommendations.forEach(rec => {
            const originalCard = NODES.allPlansStorage.content.getElementById(rec.planId);
            if (originalCard) {
                const clonedCardContainer = document.createElement('div');
                clonedCardContainer.className = 'carousel-cell';
                const clonedCard = originalCard.cloneNode(true);
                
                const reasonContainer = clonedCard.querySelector('.gemini-reason-container');
                if (reasonContainer) {
                    reasonContainer.innerHTML = `<div class="p-3 mt-4 bg-yellow-50 border-l-4 border-yellow-400 text-sm text-yellow-800 rounded-r-lg"><strong>✨ Recomendação da IA:</strong> ${rec.reason}</div>`;
                }
                clonedCardContainer.appendChild(clonedCard);
                NODES.recommendedGrid.appendChild(clonedCardContainer);
            }
        });
        
        new Flickity(NODES.recommendedGrid, { wrapAround: true, pageDots: true, cellAlign: 'left', contain: true, imagesLoaded: true, autoPlay: false });
        
        NODES.recommendedContainer.classList.remove('hidden');
        NODES.allPlansContainer.classList.add('hidden');
        NODES.recommendedContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
    
    const citiesString = "Aguaí, Águas de Santa Bárbara, Agudos, Alumínio, Americana, Américo Brasiliense, Amparo, Angatuba, Araçariguama, Araçoiaba da Serra, Arandu, Araraquara, Araras, Arealva, Areiópolis, Artur Nogueira, Atibaia, Avaí, Avaré, Bady Bassitt, Barra Bonita, Barretos, Bauru, Bebedouro, Biritiba-Mirim, Boa Esperança do Sul, Bocaina, Bofete, Boituva, Bom Jesus dos Perdões, Borborema, Borebi, Botucatu, Bragança Paulista, Cabreúva, Caçapava, Cafelândia, Caieiras, Campina do Monte Alegre, Campinas, Campo Limpo Paulista, Cândido Rodrigues, Capela do Alto, Capivari, Casa Branca, Cedral, Cerqueira César, Cerquilho, Cesário Lange, Colina, Conchal, Conchas, Cordeirópolis, Cosmópolis, Cravinhos, Cristais Paulista, Cubatão, Descalvado, Dobrada, Dois Córregos, Dourado, Elias Fausto, Engenheiro Coelho, Estiva Gerbi, Fernando Prestes, Franca, Francisco Morato, Franco da Rocha, Gavião Peixoto, Guaíra, Guapiaçu, Guarantã, Guararema, Guariba, Guarujá, Guatapará, Holambra, Hortolândia, Iaras, Ibaté, Ibitinga, Igaraçu do Tietê, Igaratá, Indaiatuba, Iperó, Iracemápolis, Itaí, Itajobi, Itaju, Itanhaém, Itapetininga, Itápolis, Itapuí, Itatinga, Itirapuã, Itu, Itupeva, Jaborandi, Jaboticabal, Jacareí, Jaguariúna, Jarinu, Jaú, Jumirim, Jundiaí, Laranjal Paulista, Leme, Lençóis Paulista, Limeira, Lindóia, Lins, Louveira, Macatuba, Mairiporã, Manduri, Matão, Mineiros do Tietê, Mirassol, Mogi das Cruzes, Mogi Guaçu, Mogi Mirim, Mongaguá, Monte Alegre do Sul, Monte Alto, Monte Mor, Motuca, Nazaré Paulista, Nova Europa, Nova Odessa, Óleo, Olímpia, Paranapanema, Pardinho, Patrocínio Paulista, Paulínia, Pederneiras, Pedreira, Pereiras, Peruíbe, Pilar do Sul, Pindorama, Piracaia, Piracicaba, Pirajuí, Pirassununga, Piratininga, Pitangueiras, Porangaba, Porto Ferreira, Praia Grande, Pratânia, Presidente Alves, Quadra, Rafard, Ribeirão Bonito, Ribeirão Corrente, Ribeirão Preto, Rincão, Rio Claro, Rio das Pedras, Salesópolis, Saltinho, Salto de Pirapora, Santa Adélia, Santa Bárbara D’Oeste, Santa Branca, Santa Cruz das Palmeiras, Santa Ernestina, Santa Gertrudes, Santa Lúcia, Santa Rita do Passa Quatro, Santa Rosa de Viterbo, Santo Antônio de Posse, Santos, São Bernardo do Campo, São Carlos, São José do Rio Preto, São José dos Campos, São Manuel, São Vicente, Sarapuí, Serra Azul, Serra Negra, Sorocaba, Sumaré, Tabatinga, Tambaú, Taquaritinga, Tatuí, Taubaté, Tietê, Trabiju, Tremembé, Uchoa, Valinhos, Várzea Paulista, Vinhedo, Votorantim";
    const availableCities = citiesString.split(', ').sort();

    const openCityModal = () => {
        NODES.citySearchInput.value = '';
        renderCityList(availableCities);
        NODES.confirmCityBtn.disabled = true;
        NODES.cityModal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
        setTimeout(() => {
            NODES.cityModalPanel.classList.remove('opacity-0', '-translate-y-4');
        }, 10);
    };

    const closeCityModal = () => {
        NODES.cityModalPanel.classList.add('opacity-0', '-translate-y-4');
        setTimeout(() => {
            NODES.cityModal.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }, 300);
    };

    const normalizeText = (text) => text.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
    
    const renderCityList = (cities) => {
        NODES.cityListContainer.innerHTML = '';
        NODES.cityListError.classList.toggle('hidden', cities.length === 0);
        cities.forEach(city => {
            const cityButton = document.createElement('button');
            cityButton.className = 'w-full text-left px-4 py-2 text-gray-700 hover:bg-yellow-50 hover:text-brand-gold transition-colors duration-150';
            cityButton.textContent = city;
            cityButton.type = 'button';
            NODES.cityListContainer.appendChild(cityButton);
        });
    };
    
    const filterCities = () => {
        const searchTerm = normalizeText(NODES.citySearchInput.value);
        const filtered = availableCities.filter(city => normalizeText(city).includes(searchTerm));
        renderCityList(filtered);
        validateCitySelection();
    };

    const validateCitySelection = () => {
        const currentInput = normalizeText(NODES.citySearchInput.value);
        const isValid = availableCities.some(city => normalizeText(city) === currentInput);
        NODES.confirmCityBtn.disabled = !isValid;
    };

    function openCheckoutModal(planData) {
        NODES.selectedPlanNameSpan.textContent = planData.plan;
        NODES.whatsappForm.dataset.plan = planData.plan;
        NODES.whatsappForm.dataset.price = planData.price;

        NODES.whatsappForm.reset();
        clearFormErrors();
        NODES.radioLabels.forEach(label => label.classList.remove('is-checked'));
        NODES.whatsappFormContainer.classList.remove('hidden');
        NODES.whatsappSuccessContainer.classList.add('hidden');
        NODES.checkoutModal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
        NODES.checkoutModal.focus();
    }

    function closeCheckoutModal() {
        NODES.checkoutModal.classList.add('hidden');
        document.body.style.overflow = 'auto';
    }

    function handleRadioChange(event) {
        const currentLabel = event.currentTarget;
        NODES.radioLabels.forEach(label => label.classList.remove('is-checked'));
        currentLabel.classList.add('is-checked');
        document.getElementById('radio-error-message').textContent = '';
    }
    
    function applyInputMask(input, maskFunction) {
        input.addEventListener('input', (e) => { e.target.value = maskFunction(e.target.value); });
    }

    const maskCPF = value => value.replace(/\D/g, '').replace(/(\d{3})(\d)/, '$1.$2').replace(/(\d{3})(\d)/, '$1.$2').replace(/(\d{3})(\d{1,2})$/, '$1-$2');
    const maskTel = value => value.replace(/\D/g, '').replace(/(\d{2})(\d)/, '($1) $2').replace(/(\d{5})(\d)/, '$1-$2').replace(/(-\d{4})\d+?$/, '$1');
    const maskCEP = value => value.replace(/\D/g, '').replace(/(\d{5})(\d)/, '$1-$2').replace(/(-\d{3})\d+?$/, '$1');

    function validateField(input) {
        let isValid = input.checkValidity();
        const errorContainer = input.nextElementSibling;
        
        if (input.name === 'wa-cpf') isValid = isValid && /^\d{3}\.\d{3}\.\d{3}-\d{2}$/.test(input.value);
        if (input.name === 'wa-tel1') isValid = isValid && /^\(\d{2}\) \d{5}-\d{4}$/.test(input.value);
        if (input.name === 'wa-cep') isValid = isValid && /^\d{5}-\d{3}$/.test(input.value);

        if (errorContainer) {
            input.classList.toggle('is-invalid', !isValid);
            errorContainer.textContent = isValid ? '' : (input.validationMessage || 'Campo inválido.');
        }
        return isValid;
    }

    function clearFormErrors() {
         NODES.whatsappForm.querySelectorAll('.form-input').forEach(input => {
            input.classList.remove('is-invalid');
            if (input.nextElementSibling?.classList.contains('error-message')) {
                input.nextElementSibling.textContent = '';
            }
        });
        document.getElementById('radio-error-message').textContent = '';
    }

    async function handleWhatsappSubmit(e) {
        e.preventDefault();
        clearFormErrors();

        let isFormValid = Array.from(NODES.whatsappForm.querySelectorAll('input[required]:not([type=radio])')).every(validateField);
        
        const radioChecked = NODES.whatsappForm.querySelector('input[name="installation_period"]:checked');
        if (!radioChecked) {
            document.getElementById('radio-error-message').textContent = 'Por favor, selecione um período.';
            isFormValid = false;
        }

        if (!isFormValid) return;

        const formData = new FormData(NODES.whatsappForm);
        const data = Object.fromEntries(formData.entries());
        const { plan, price } = NODES.whatsappForm.dataset;
        const message = `✨ NOVO PEDIDO DE CADASTRO ✨\n-----------------------------------\nPlano Escolhido: *${plan}*\nValor: *${price}*\n-----------------------------------\n🔹 NOME COMPLETO: ${data['wa-nome']}\n🔹 NOME DA MÃE: ${data['wa-mae']}\n🔹 DATA DE NASCIMENTO: ${data['wa-nascimento']}\n🔹 CPF: ${data['wa-cpf']}\n🔹 RG: ${data['wa-rg']}\n� E-MAIL: ${data['wa-email']}\n🔹 TELEFONE TITULAR: ${data['wa-tel1']}\n🔹 ENDEREÇO: Rua ${data['wa-rua']}, Nº ${data['wa-numero']}, Bairro ${data['wa-bairro']}, Cidade ${data['wa-cidade']}, CEP ${data['wa-cep']}\n🔹 INSTALAÇÃO: ${data.installation_period}`;

        NODES.whatsappSendLink.href = `https://wa.me/${CONFIG.whatsappNumber}?text=${encodeURIComponent(message)}`;
        NODES.whatsappFormContainer.classList.add('hidden');
        NODES.whatsappSuccessContainer.classList.remove('hidden');
    }
    
    async function fetchAddressFromCEP(cep) {
        const cleanCep = cep.replace(/\D/g, '');
        if (cleanCep.length !== 8) return;
        try {
            const response = await fetch(`https://viacep.com.br/ws/${cleanCep}/json/`);
            if (!response.ok) throw new Error('CEP não encontrado');
            const address = await response.json();
            if (address.erro) throw new Error('CEP inválido');
            document.getElementById('wa-rua').value = address.logradouro || '';
            document.getElementById('wa-bairro').value = address.bairro || '';
            document.getElementById('wa-cidade').value = address.localidade || '';
        } catch (error) {
            console.error("Erro ao buscar CEP:", error);
        }
    }
    
    initScrollAnimation();

    if (NODES.promoCarousel) {
        new Flickity(NODES.promoCarousel, { wrapAround: true, autoPlay: false, pageDots: true, cellAlign: 'left', contain: true, imagesLoaded: true });
    }
    
    NODES.menuBtn.addEventListener('click', toggleMobileMenu);
    NODES.mobileMenuLinks.forEach(link => link.addEventListener('click', toggleMobileMenu));
    
    if (NODES.recommendBtn) {
        NODES.recommendBtn.addEventListener('click', handleRecommendation);
    }
    
    NODES.closeCityModalBtn.addEventListener('click', closeCityModal);
    NODES.cityModal.addEventListener('click', (e) => { if (e.target === NODES.cityModal) closeCityModal(); });
    NODES.citySearchInput.addEventListener('input', filterCities);
    NODES.cityListContainer.addEventListener('click', (e) => {
        if (e.target.tagName === 'BUTTON') {
            NODES.citySearchInput.value = e.target.textContent;
            filterCities();
        }
    });
    NODES.confirmCityBtn.addEventListener('click', () => {
        openCheckoutModal(selectedPlanInfo);
        closeCityModal();
    });

    NODES.closeModalBtn.addEventListener('click', closeCheckoutModal);
    NODES.checkoutModal.addEventListener('click', (e) => { if (e.target === NODES.checkoutModal) closeCheckoutModal(); });
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !NODES.checkoutModal.classList.contains('hidden')) closeCheckoutModal();
    });
    
    document.body.addEventListener('click', (e) => {
        const contratarBtn = e.target.closest('.contratar-btn');
        if (contratarBtn) {
            e.preventDefault();
            const card = contratarBtn.closest('.plan-card');
            if (card) {
                selectedPlanInfo = { 
                    plan: card.dataset.plan, 
                    price: card.dataset.price 
                };
                openCityModal();
            }
        }
    });

    NODES.whatsappForm.addEventListener('submit', handleWhatsappSubmit);
    NODES.radioLabels.forEach(label => label.addEventListener('click', handleRadioChange));

    applyInputMask(NODES.cpfInput, maskCPF);
    applyInputMask(NODES.telInput, maskTel);
    applyInputMask(NODES.cepInput, maskCEP);
    
    NODES.cepInput.addEventListener('blur', (e) => fetchAddressFromCEP(e.target.value));

        // =======================================================
    // INÍCIO: CÓDIGO DO JARVIS - IA DE CONVERSAÇÃO (VERSÃO FINAL APRIMORADA)
    // =======================================================
    
    const jarvisNodes = {
        chatButton: document.getElementById('jarvis-chat-button'),
        chatContainer: document.getElementById('jarvis-chat-container'),
        chatLog: document.getElementById('jarvis-chat-log'),
        userInput: document.getElementById('jarvis-user-input'),
        sendButton: document.getElementById('jarvis-send-button'),
        openIcon: document.getElementById('jarvis-open-icon'),
        closeIcon: document.getElementById('jarvis-close-icon')
    };

    const userSessions = {};
    const userId = "site-user-" + Math.random().toString(36).substr(2, 9);

    const KNOWLEDGE_BASE = {
        planos: {
            "Fibra Home 200M+": { preco: "R$79,99", download: "200 Mbps", upload: "100 Mbps", perfil: "Ideal para clientes com orçamento limitado, que moram sozinhos ou em casal, e têm um uso básico da internet (redes sociais, vídeos em HD, e-mails).", argumento: "Este plano é focado no essencial, com uma ótima taxa de upload para essa faixa de preço." },
            "Fibra Home 400M+": { preco: "R$94,99", download: "400 Mbps", upload: "200 Mbps", perfil: "Atende bem uma família, garantindo que todos possam assistir vídeos e navegar sem travar. Essencial para home office com videochamadas.", argumento: "Para quem trabalha em casa, a velocidade de envio de arquivos é crucial. Este plano já oferece 200 Mega de upload, o que deixa suas videochamadas com ótima qualidade." },
            "Fibra Home 600M+": { preco: "R$99,99", download: "600 Mbps", upload: "300 Mbps", perfil: "Melhor custo-benefício de entrada. Garante que mesmo com todos conectados ao mesmo tempo, a qualidade continue perfeita.", argumento: "Por apenas R$ 5 a mais que o plano de 400M, o senhor leva 200 Mega a mais de download. É um salto de performance muito grande por uma diferença mínima." },
            "Fibra Home 600M+ Max": { preco: "R$119,99", download: "600 Mbps", upload: "300 Mbps", perfil: "Mesma velocidade do 600M+ padrão, mas com hardware superior (ex: roteador Wi-Fi 6) para melhor cobertura e desempenho.", argumento: "Este plano inclui um roteador superior para garantir que o sinal de Wi-Fi chegue com força total em mais ambientes da casa." },
            "Fibra Home 1G+": { preco: "R$119,99", download: "1 Gbps", upload: "500 Mbps", perfil: "Melhor custo-benefício de alta velocidade. Para clientes que buscam a máxima performance para downloads rápidos de jogos e arquivos.", argumento: "Se o foco é ter a velocidade bruta para baixar jogos e arquivos rapidamente, este plano de 1 Giga entrega uma experiência fantástica por um preço excelente." },
            "Fibra Home 1G+ Gamer": { preco: "R$169,99", download: "1 Gbps", upload: "500 Mbps", perfil: "Plano desenhado para gamers, com rotas otimizadas para servidores de jogos, garantindo baixa latência (ping).", argumento: "Se o senhor joga online, sabe que o ping baixo é tudo. Este plano é desenhado para isso, com rotas otimizadas para os servidores dos principais jogos e 500 Mega de upload para suas lives." },
            "Fibra Home 1G+ Home Office": { preco: "R$169,99", download: "1 Gbps", upload: "500 Mbps", perfil: "Otimizado para as principais ferramentas de trabalho, garantindo estabilidade em reuniões importantes.", argumento: "Este plano foi pensado para o profissional. Além da velocidade máxima, ele tem otimização para as principais ferramentas de trabalho, garantindo que sua internet não falhe em uma reunião importante." },
            "Fibra Home 1G+ Black": { preco: "R$199,99", download: "1 Gbps", upload: "500 Mbps", perfil: "Para heavy users e casas conectadas, vem com equipamentos premium (Wi-Fi 6/6E, talvez rede Mesh) para cobertura total.", argumento: "Para quem precisa não só de velocidade, mas de um sinal que cubra a casa toda com qualidade, o plano Black vem com equipamentos premium para garantir que todos os seus dispositivos funcionem perfeitamente." },
            "Fibra Home 1G+ Black c/ Disney+": { preco: "R$239,99", download: "1 Gbps", upload: "500 Mbps", perfil: "O pacote completo: internet mais rápida, equipamentos premium e assinatura do Disney+ inclusa.", argumento: "Para a família que quer o pacote completo: a internet mais rápida possível e já com o Disney+ incluso, tudo numa fatura só." },
            "Fibra Home Socio Ponte Preta ou Guarani": { preco: "Preço Especial", download: "800 Mbps", upload: "400 Mbps", perfil: "Plano exclusivo para sócios torcedores com velocidade e preço especiais.", argumento: "Se o senhor é torcedor de coração, temos um plano exclusivo que, além de ter uma super velocidade, ainda ajuda o seu time." },
            "Fibra Home 600M+ Movel 10G ou 15G": { preco: "Consultar", download: "600 Mbps", upload: "300 Mbps", perfil: "Combo de internet residencial com plano de celular, unificando as contas.", argumento: "Com nosso combo, o senhor leva uma internet de 600 Mega para casa e ainda um plano de celular. Fica tudo em uma conta só e muitas vezes sai mais barato." }
        },
        cidadesComCobertura: new Set(['aguaí', 'aguai', 'águas de santa bárbara', 'aguas de santa barbara', 'agudos', 'alumínio', 'aluminio', 'americana', 'américo brasiliense', 'americo brasiliense', 'amparo', 'angatuba', 'araçariguama', 'aracariguama', 'araçoiaba da serra', 'aracoiaba da serra', 'arandu', 'araraquara', 'araras', 'arealva', 'areiópolis', 'areiopolis', 'artur nogueira', 'atibaia', 'avaí', 'avai', 'avaré', 'avare', 'bady bassitt', 'barra bonita', 'barretos', 'bauru', 'bebedouro', 'biritiba-mirim', 'boa esperança do sul', 'boa esperanca do sul', 'bocaina', 'bofete', 'boituva', 'bom jesus dos perdões', 'bom jesus dos perdoes', 'borborema', 'borebi', 'botucatu', 'bragança paulista', 'braganca paulista', 'cabreúva', 'cabreuva', 'caçapava', 'cacapava', 'cafelândia', 'cafelandia', 'caieiras', 'campina do monte alegre', 'campinas', 'campo limpo paulista', 'cândido rodrigues', 'candido rodrigues', 'capela do alto', 'capivari', 'casa branca', 'cedral', 'cerqueira césar', 'cerqueira cesar', 'cerquilho', 'cesário lange', 'cesario lange', 'colina', 'conchal', 'conchas', 'cordeirópolis', 'cordeiropolis', 'cosmópolis', 'cosmopolis', 'cravinhos', 'cristais paulista', 'cubatão', 'cubatao', 'descalvado', 'dobrada', 'dois córregos', 'dois corregos', 'dourado', 'elias fausto', 'engenheiro coelho', 'estiva gerbi', 'fernando prestes', 'franca', 'francisco morato', 'franco da rocha', 'gavião peixoto', 'gaviao peixoto', 'guaíra', 'guaira', 'guapiaçu', 'guapiacu', 'guarantã', 'guaranta', 'guararema', 'guariba', 'guarujá', 'guaruja', 'guatapará', 'guatapara', 'holambra', 'hortolândia', 'hortolandia', 'iaras', 'ibaté', 'ibate', 'ibitinga', 'igaraçu do tietê', 'igaracu do tiete', 'igaratá', 'igarata', 'indaiatuba', 'iperó', 'ipero', 'iracemápolis', 'iracemapolis', 'itaí', 'itai', 'itajobi', 'itaju', 'itanhaém', 'itanhaem', 'itapetininga', 'itápolis', 'itapolis', 'itapuí', 'itapui', 'itatinga', 'itirapuã', 'itirapua', 'itu', 'itupeva', 'jaborandi', 'jaboticabal', 'jacareí', 'jacarei', 'jaguariúna', 'jaguariuna', 'jarinu', 'jaú', 'jau', 'jumirim', 'jundiaí', 'jundiai', 'laranjal paulista', 'leme', 'lençóis paulista', 'lencois paulista', 'limeira', 'lindóia', 'lindoia', 'lins', 'louveira', 'macatuba', 'mairiporã', 'mairipora', 'manduri', 'matão', 'matao', 'mineiros do tietê', 'mineiros do tiete', 'mirassol', 'mogi das cruzes', 'mogi guaçu', 'mogi guacu', 'mogi mirim', 'mongaguá', 'mongagua', 'monte alegre do sul', 'monte alto', 'monte mor', 'motuca', 'nazaré paulista', 'nazare paulista', 'nova europa', 'nova odessa', 'óleo', 'oleo', 'olímpia', 'olimpia', 'paranapanema', 'pardinho', 'patrocínio paulista', 'patrocinio paulista', 'paulínia', 'paulinia', 'pederneiras', 'pedreira', 'pereiras', 'peruíbe', 'peruibe', 'pilar do sul', 'pindorama', 'piracaia', 'piracicaba', 'pirajuí', 'pirajui', 'pirassununga', 'piratininga', 'pitangueiras', 'porangaba', 'porto ferreira', 'praia grande', 'pratânia', 'pratania', 'presidente alves', 'quadra', 'rafard', 'ribeirão bonito', 'ribeirao bonito', 'ribeirão corrente', 'ribeirao corrente', 'ribeirão preto', 'ribeirao preto', 'rincão', 'rincao', 'rio claro', 'rio das pedras', 'salesópolis', 'salesopolis', 'saltinho', 'salto de pirapora', 'santa adélia', 'santa adelia', 'santa bárbara d’oeste', 'santa barbara d’oeste', 'santa branca', 'santa cruz das palmeiras', 'santa ernestina', 'santa gertrudes', 'santa lúcia', 'santa lucia', 'santa rita do passa quatro', 'santa rosa de viterbo', 'santo antônio de posse', 'santo antonio de posse', 'santos', 'são bernardo do campo', 'sao bernardo do campo', 'são carlos', 'sao carlos', 'são josé do rio preto', 'sao jose do rio preto', 'são josé dos campos', 'sao jose dos campos', 'são manuel', 'sao manuel', 'são vicente', 'sao vicente', 'sarapuí', 'sarapui', 'serra azul', 'serra negra', 'sorocaba', 'sumaré', 'sumare', 'tabatinga', 'tambaú', 'tambau', 'taquaritinga', 'tatuí', 'tatui', 'taubaté', 'taubate', 'tietê', 'tiete', 'trabiju', 'tremembé', 'tremembe', 'uchoa', 'valinhos', 'várzea paulista', 'varzea paulista', 'vinhedo', 'votorantim'])
};

    const tools = [{
        functionDeclarations: [
            {
                name: "start_customer_registration",
                description: "Inicia o processo de cadastro do cliente após ele ter fornecido todos os dados necessários e confirmado o plano. Esta função finaliza a coleta de dados e envia para o sistema.",
                parameters: { type: "OBJECT", properties: { plano: { type: "STRING" }, nome_completo: { type: "STRING" }, nome_mae: { type: "STRING" }, data_nascimento: { type: "STRING" }, cpf: { type: "STRING" }, rg: { type: "STRING" }, email: { type: "STRING" }, rua_numero: { type: "STRING" }, bairro: { type: "STRING" }, cidade: { type: "STRING" }, cep: { type: "STRING" }, periodo_instalacao: { type: "STRING" } }, required: ["plano", "nome_completo", "nome_mae", "data_nascimento", "cpf", "rg", "email", "rua_numero", "bairro", "cidade", "cep", "periodo_instalacao"] }
            },
            {
                name: "validate_cpf",
                description: "Valida um número de CPF para verificar se é um documento matematicamente válido.",
                parameters: { type: "OBJECT", properties: { cpf: { type: "STRING" } }, required: ["cpf"] }
            },
            {
                name: "check_address_coverage",
                description: "Verifica se a cidade informada pelo cliente possui cobertura da Piel Telecom.",
                parameters: { type: "OBJECT", properties: { cidade: { type: "STRING" } }, required: ["cidade"] }
            },
            {
                name: "get_plan_details",
                description: "Busca e retorna os detalhes de um plano de internet específico, como preço, velocidades e perfil de uso.",
                parameters: { type: "OBJECT", properties: { nome_do_plano: { type: "STRING", description: "O nome do plano a ser consultado, ex: 'Fibra Home 600M+'" } }, required: ["nome_do_plano"] }
            }
        ]
    }];

    const toolFunctions = {
        validate_cpf: ({ cpf }) => {
            cpf = cpf.replace(/[^\d]+/g, '');
            if (cpf.length !== 11 || /^(\d)\1{10}$/.test(cpf)) return { "isValid": false };
            let sum = 0, remainder;
            for (let i = 1; i <= 9; i++) sum += parseInt(cpf.substring(i - 1, i)) * (11 - i);
            remainder = (sum * 10) % 11;
            if ((remainder === 10) || (remainder === 11)) remainder = 0;
            if (remainder !== parseInt(cpf.substring(9, 10))) return { "isValid": false };
            sum = 0;
            for (let i = 1; i <= 10; i++) sum += parseInt(cpf.substring(i - 1, i)) * (12 - i);
            remainder = (sum * 10) % 11;
            if ((remainder === 10) || (remainder === 11)) remainder = 0;
            if (remainder !== parseInt(cpf.substring(10, 11))) return { "isValid": false };
            return { "isValid": true };
        },
        check_address_coverage: ({ cidade }) => {
            const hasCoverage = KNOWLEDGE_BASE.cidadesComCobertura.has(cidade.toLowerCase().trim());
            return { hasCoverage };
        },
        get_plan_details: ({ nome_do_plano }) => {
            let plan = null;
            const searchKey = Object.keys(KNOWLEDGE_BASE.planos).find(key => key.toLowerCase().includes(nome_do_plano.toLowerCase()));
            if (searchKey) {
                plan = KNOWLEDGE_BASE.planos[searchKey];
            }

            if (plan) {
                return { success: true, details: plan };
            }
            return { success: false, message: "Plano não encontrado." };
        },
        start_customer_registration: (data) => {
            console.log("REGISTRATION DATA TO BE SENT TO CRM:", data);
            return { success: true, message: "Cadastro recebido. Um consultor humano irá revisar e confirmar os detalhes." };
        }
    };

    async function callGeminiAPI(history) {
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${USER_API_KEY}`;
        const payload = { contents: history, tools };
        try {
            const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) throw new Error(`API Error: ${response.status}`);
            return await response.json();
        } catch (error) {
            console.error("Gemini API call failed:", error);
            return { error: "Não foi possível conectar à IA no momento. Tente novamente mais tarde." };
        }
    }

    async function handleJarvisMessage(message) {
        const session = userSessions[userId];
        session.history.push({ role: "user", parts: [{ text: message }] });

        addTypingIndicator();
        let apiResponse = await callGeminiAPI(session.history);
        removeTypingIndicator();

        if (apiResponse.error) return apiResponse.error;
        if (!apiResponse.candidates || apiResponse.candidates.length === 0) {
             return "Desculpe, não consegui processar sua solicitação no momento.";
        }

        let responsePart = apiResponse.candidates[0].content.parts[0];

        while (responsePart.functionCall) {
            const functionCall = responsePart.functionCall;
            const functionName = functionCall.name;
            const functionArgs = functionCall.args;

            if (toolFunctions[functionName]) {
                const toolResult = toolFunctions[functionName](functionArgs);
                session.history.push({ role: "model", parts: [{ functionCall }] });
                session.history.push({ role: "tool", parts: [{ functionResponse: { name: functionName, response: toolResult } }] });

                addTypingIndicator();
                apiResponse = await callGeminiAPI(session.history);
                removeTypingIndicator();
                
                if (!apiResponse.candidates || apiResponse.candidates.length === 0) {
                    return "Ocorreu um erro ao processar a resposta da ferramenta.";
                }
                responsePart = apiResponse.candidates[0].content.parts[0];
            }
        }

        const modelResponse = responsePart.text;
        session.history.push({ role: "model", parts: [{ text: modelResponse }] });
        return modelResponse;
    }

    function formatMessage(text) {
        if (typeof text !== 'string') return '';
        return text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
    }

    function addMessageToLog(message, sender) {
        const messageContainer = document.createElement('div');
        messageContainer.className = sender === 'user' ? 'user-message' : 'jarvis-message';
        
        const bubble = document.createElement('div');
        bubble.className = 'message-bubble';
        bubble.innerHTML = formatMessage(message);

        messageContainer.appendChild(bubble);
        jarvisNodes.chatLog.appendChild(messageContainer);
        jarvisNodes.chatLog.scrollTop = jarvisNodes.chatLog.scrollHeight;
    }

    function addTypingIndicator() {
        const indicator = document.createElement('div');
        indicator.id = 'typing-indicator-bubble';
        indicator.className = 'jarvis-message';
        indicator.innerHTML = `<div class="message-bubble"><div class="typing-indicator"><span></span><span></span><span></span></div></div>`;
        jarvisNodes.chatLog.appendChild(indicator);
        jarvisNodes.chatLog.scrollTop = jarvisNodes.chatLog.scrollHeight;
    }

    function removeTypingIndicator() {
        const indicator = document.getElementById('typing-indicator-bubble');
        if (indicator) indicator.remove();
    }

    async function sendUserMessage() {
        const message = jarvisNodes.userInput.value.trim();
        if (message === '') return;
        
        addMessageToLog(message, 'user');
        jarvisNodes.userInput.value = '';
        jarvisNodes.userInput.disabled = true;
        jarvisNodes.sendButton.disabled = true;

        const jarvisResponse = await handleJarvisMessage(message);
        addMessageToLog(jarvisResponse, 'jarvis');

        jarvisNodes.userInput.disabled = false;
        jarvisNodes.sendButton.disabled = false;
        jarvisNodes.userInput.focus();
    }

    function toggleChat() {
        const isOpen = jarvisNodes.chatContainer.classList.toggle('is-open');
        jarvisNodes.openIcon.classList.toggle('hidden', isOpen);
        jarvisNodes.closeIcon.classList.toggle('hidden', !isOpen);
        if (isOpen) {
            initJarvisSession();
            jarvisNodes.userInput.focus();
        }
    }

    function initJarvisSession() {
        const session = userSessions[userId];
        if (!session || !session.history) {
            const planosParaPrompt = JSON.stringify(KNOWLEDGE_BASE.planos, null, 2);
            userSessions[userId] = {
                history: [
                    { role: "user", parts: [{ text: `System instruction: Você é Jarvis, um assistente de IA da Piel Telecom. Seu objetivo principal é qualificar leads e conduzir o processo de venda de planos de internet fibra óptica de forma consultiva e eficiente.
Persona: Seja sempre extremamente educado, proativo, sofisticado e preciso, como um mordomo tecnológico. Trate o cliente por "Senhor". Sua comunicação deve ser clara e inspirar confiança.
Fluxo de Conversa:
1. Saudação e Análise: Comece se apresentando e perguntando sobre a necessidade do cliente para entender o perfil de uso (Família, Gamer, Home Office, etc.).
2. Recomendação: Com base na necessidade, recomende o melhor plano. Use a ferramenta 'get_plan_details' para obter informações específicas e justificar sua recomendação com argumentos de venda (ex: custo-benefício, velocidade de upload).
3. Coleta de Dados: Se o cliente aceitar, inicie a coleta de dados para o cadastro, uma informação por vez (Nome Completo, Nome da Mãe, etc.).
4. Validação e Verificação Imediata: Assim que o cliente fornecer um CPF ou uma cidade, você DEVE usar a ferramenta correspondente ('validate_cpf' ou 'check_address_coverage') imediatamente na sua próxima ação. Reaja ao resultado da ferramenta de forma natural (ex: "CPF válido, obrigado. Agora, qual o seu RG?" ou "Um momento, Senhor, enquanto verifico a cobertura em sua cidade."). Não espere por confirmação para validar. O fluxo deve ser contínuo.
5. Finalização: Após coletar todos os dados, chame a ferramenta 'start_customer_registration' para finalizar e informe ao cliente que um consultor humano entrará em contato.
Regras Importantes:
- Não invente planos ou preços. Use apenas as informações da sua base de conhecimento através da ferramenta 'get_plan_details'.
- Se a cidade do cliente não estiver na lista de cobertura, informe-o educadamente e diga que o contato será guardado para futuras expansões. Encerre o fluxo de venda nesse ponto.
- Se um dado for inválido (ex: CPF), peça para o cliente verificar e informar novamente.
- Mantenha o controle da conversa, guiando o cliente passo a passo de forma proativa.
Base de Conhecimento de Planos (para consulta via ferramenta): ${planosParaPrompt}` }] },
                    { role: "model", parts: [{ text: "Olá, Senhor. Eu sou o Jarvis, assistente virtual da Piel Telecom. Como posso auxiliá-lo a encontrar o plano de fibra óptica ideal para suas necessidades?" }] }
                ]
            };
            addMessageToLog(userSessions[userId].history[1].parts[0].text, 'jarvis');
        }
    }

    jarvisNodes.chatButton.addEventListener('click', toggleChat);
    jarvisNodes.sendButton.addEventListener('click', sendUserMessage);
    jarvisNodes.userInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendUserMessage();
    });
});

    </script>
</body>
</html>
